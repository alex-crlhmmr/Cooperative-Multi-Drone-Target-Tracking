# Visualization Reference

All visualization code is in `src/viz/`. Plots are generated automatically by the experiment scripts — this page documents what each plot shows and how to save them.

---

## Saving Plots

Add `--save` to any script to save all plots as PNG files in `results/`:

```bash
python scripts/run_filters.py --no-gui --save --steps 300
python scripts/monte_carlo.py --runs 100 --save
```

Saved files follow the pattern `results/<script>_<traj>_<plot_type>.png`.

---

## Filter Diagnostic Plots

**Source:** `src/viz/filter_plots.py`

### State Estimates

Six-panel plot showing true state vs filter estimates for each state dimension (px, py, pz, vx, vy, vz), with 3-sigma covariance bands.

**Generated by:** `run_filters.py`

**What to look for:**
- Estimate convergence speed
- 3-sigma band width (filter confidence)
- Whether truth stays inside the bands (filter consistency)

---

### RMSE Over Time

Position and velocity RMSE on a log scale, one curve per filter.

**Generated by:** `run_filters.py`, `run_consensus.py`, `run_consensus_imm.py`

**What to look for:**
- Convergence rate (how fast error drops)
- Steady-state error level
- Divergence during maneuvers (evasive trajectory)

---

### NEES Over Time

Normalized Estimation Error Squared with chi-squared 95% confidence bounds. A well-calibrated filter should have NEES near the state dimension (6).

**Generated by:** `run_filters.py`, `run_consensus.py`, `run_consensus_imm.py`

**What to look for:**
- NEES >> 6 indicates overconfidence (covariance too small)
- NEES << 6 indicates underconfidence (covariance too large)
- PF typically has the best-calibrated NEES

---

### Covariance Trace

Trace of position and velocity covariance blocks on a log scale. Shows how filter uncertainty evolves.

**Generated by:** `run_filters.py`

**What to look for:**
- Initial uncertainty reduction (filter converging)
- Steady-state uncertainty level
- Covariance growth during sensor blackouts

---

### 3D Trajectory

3D plot showing true target path and each filter's estimated path with start markers.

**Generated by:** `run_filters.py`

---

### Monte Carlo Box Plots

Four-panel comparison across filters and trajectories: position RMSE, velocity RMSE, ANEES, and convergence time. Each box shows the distribution over N trials.

**Generated by:** `monte_carlo.py`

**What to look for:**
- Median performance differences between filters
- Variance (box width) — consistency across random seeds
- Outliers — occasional divergence or track loss

---

### Track Loss Bar Chart

Stacked bars showing track loss rates per filter per trajectory. Distinguishes between error-based loss (filter diverged) and sensor blackout loss (target left detection range).

**Generated by:** `monte_carlo.py`

---

## Consensus Diagnostic Plots

**Source:** `src/viz/consensus_plots.py`

### Per-Drone Local Estimates

Three-panel plot (px, py, pz) showing each drone's local estimate as a thin colored line, the consensus average as a dashed blue line, and the centralized baseline as a solid red line (when available). Truth is shown in black.

**Generated by:** `run_consensus.py`, `run_consensus_imm.py`

**What to look for:**
- How quickly local estimates converge to agreement
- Spread between drones (consensus quality)
- Gap between consensus average and centralized baseline

---

### Topology Comparison

Two-panel plot (position RMSE, velocity RMSE) with one curve per topology, colored by type.

**Generated by:** `run_consensus.py` with `--all-topologies`

---

### Consensus Convergence (Disagreement)

Single panel showing the RMS disagreement between local estimates over time. Disagreement is the spread of per-drone estimates around their mean.

**Generated by:** `run_consensus.py`, `run_consensus_imm.py`

**What to look for:**
- Convergence to near-zero (all drones agree)
- Spikes during maneuvers (temporary disagreement)
- Effect of topology and dropout on steady-state disagreement

---

### Parameter Sweep Plots

**Iteration sweep (L):** RMSE vs number of consensus iterations, one curve per topology. Shows diminishing returns.

**Step size sweep (epsilon):** RMSE vs consensus step size. Shows the stability-convergence tradeoff.

**Dropout degradation:** RMSE vs dropout probability, one curve per topology. Shows graceful degradation.

**Generated by:** `run_consensus.py` with `--sweep-L`, `--sweep-eps`, `--sweep-dropout`

---

### Topology Diagrams

Three-panel NetworkX visualization showing the full, ring, and star graph structures for N=5 drones.

**Generated by:** Available via `draw_topology_diagrams(n=5)` in `src/viz/consensus_plots.py`

---

### Monte Carlo Dropout Curves

Median RMSE with IQR shading vs dropout probability, one curve per topology. Shows statistical robustness of each topology to communication loss.

**Generated by:** `monte_carlo_consensus.py`

---

### Monte Carlo Topology Box Plots

Box plots comparing topologies for each trajectory type. Shows the distribution of RMSE across trials.

**Generated by:** `monte_carlo_consensus.py`

---

## IMM-Specific Plots

### Mode Probabilities

Time series of IMM mode probabilities: P(gentle) and P(aggressive). One panel per IMM filter (centralized IMM and/or consensus IMM).

**Generated by:** `run_consensus_imm.py`

**What to look for:**
- Mode switches during maneuvers (P(aggressive) rises)
- Return to gentle mode during straight segments
- Consensus IMM vs centralized IMM mode agreement

---

## Interactive 3D Animations

**Source:** `src/viz/animation.py`

All animations include playback controls: Play/Pause, Restart, speed buttons (0.5x, 1x, 2x, 4x), and a time scrub slider.

### Filter Tracking Replay

Shows observer drones (gray dots), true target (red), and filter estimates (colored squares). Live error readout in a side panel.

**Generated by:** `run_filters.py`

---

### Consensus Tracking Replay

Full-featured replay showing:
- **Observer drones** — colored dots, one color per drone
- **Communication links** — cyan solid lines (active), red dashed lines (dropped)
- **Per-drone local estimates** — small colored diamonds matching each drone's color
- **Consensus average** — blue square with trail
- **Centralized baseline** — red square with trail (when available)
- **True target** — black dot with dashed trail
- **Bearing lines** — green (true direction) and red (noisy measurement) from each drone
- **Info panel** — live position error, velocity error, disagreement, detection count

**Generated by:** `run_consensus.py`, `run_consensus_imm.py`

### Saving Animations

Animations can be saved to video by passing `save_path` programmatically. Requires ffmpeg:

```bash
conda install -c conda-forge ffmpeg
```
